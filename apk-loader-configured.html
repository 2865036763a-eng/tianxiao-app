<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©ç¬‘ã®ç§˜å¯†åŸºåœ°</title>
    <style>
        body { margin: 0; font-family: sans-serif; }
        #loading {
            position: fixed; inset: 0;
            display: flex; align-items: center; justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; flex-direction: column;
        }
        .spinner {
            width: 50px; height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white; border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        #app { display: none; }
    </style>
</head>
<body>
    <div id="loading">
        <h2>ğŸŒ¸ åŠ è½½ä¸­...</h2>
        <div class="spinner"></div>
        <p id="status">æ­£åœ¨è·å–æœ€æ–°å†…å®¹</p>
    </div>
    <div id="app"></div>

    <script>
    // ========================================
    // è¿™æ˜¯ä½ çš„ä¸“å±é…ç½® - å·²ç»é…ç½®å¥½äº†ï¼
    // ========================================
    const url = 'https://2865036763a-eng.github.io/tianxiao-app/tianxiao.html';

    async function load() {
        try {
            document.getElementById('status').textContent = 'ä¸‹è½½ä¸­...';
            
            // å°è¯•ä»ç¼“å­˜åŠ è½½
            const cached = localStorage.getItem('content');
            if (cached) {
                show(cached);
                document.getElementById('status').textContent = 'ä½¿ç”¨ç¼“å­˜ç‰ˆæœ¬';
            }

            // è·å–æœ€æ–°ç‰ˆæœ¬
            const response = await fetch(url, { cache: 'no-cache' });
            const content = await response.text();
            
            // ä¿å­˜ç¼“å­˜
            localStorage.setItem('content', content);
            
            // æ˜¾ç¤ºå†…å®¹
            show(content);
            
            if (cached && cached !== content) {
                alert('ğŸ‰ å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼');
            }
            
        } catch (error) {
            // å¤±è´¥æ—¶ä½¿ç”¨ç¼“å­˜
            const cached = localStorage.getItem('content');
            if (cached) {
                show(cached);
            } else {
                document.getElementById('status').textContent = 'âŒ åŠ è½½å¤±è´¥ï¼š' + error.message;
            }
        }
    }

    function show(html) {
        const app = document.getElementById('app');
        app.innerHTML = html;
        app.style.display = 'block';
        document.getElementById('loading').style.display = 'none';
        
        // æ‰§è¡Œè„šæœ¬
        app.querySelectorAll('script').forEach(old => {
            const s = document.createElement('script');
            s.textContent = old.textContent;
            old.parentNode.replaceChild(s, old);
        });
    }

    load();
    </script>
</body>
</html>
